{"version":3,"file":"submitActions.js","sourceRoot":"","sources":["../../src/writes/submitActions.ts"],"names":[],"mappings":";;;AACA,iEAAkF;AAClF,4DAA4B;AAE5B,MAAM,WAAW,GAUX,EAAE,CAAC;AAET,MAAM,YAAY,GAAG,KAAK,CAAC;AAE3B,MAAM,aAAa,GAAG,CACpB,OAAiD,EAClC,EAAE;IACjB,OAAO,OAAO,CAAC,GAAG,CAChB,OAAO,CAAC,GAAG,CACT,CAAC,MAAM,EAAE,EAAE,CACT,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC9B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC;QAChC,MAAM,EAAE,GAAG,IAAA,gBAAM,GAAE,CAAC;QACpB,MAAM,IAAI,GAAG,GAAG,EAAE,CAChB,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC;aAC9B,IAAI,CAAC,OAAO,CAAC;aACb,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE;YACX,IAAI,CAAC,CAAC,IAAI,KAAK,MAAM,EAAE;gBACrB,MAAM,MAAM,GAAG;oBACb,OAAO,EAAE,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;oBAC5C,EAAE;iBACH,CAAC;gBACF,MAAM,OAAO,GAAG,QAAQ,CAAC,cAAc,CAAC,mBAAE,CAAC,CAAC;gBAC5C,IAAI,OAAO,EAAE;oBACX,OAAO,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;iBAC3D;qBAAM;oBACL,IAAA,uBAAoB,EAAC,MAAM,CAAC,CAAC;iBAC9B;gBACD,UAAU,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;aACzB;iBAAM;gBACL,MAAM,CAAC,CAAC,CAAC,CAAC;aACX;QACH,CAAC,CAAC,CAAC;QACP,IAAI,EAAE,CAAC;IACT,CAAC,CAAC,CACL,CACF,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;AAClC,CAAC,CAAC;AAEF,kBAAe,aAAa,CAAC","sourcesContent":["import type { ActionParams } from \"../types\";\nimport { ID, render as renderProgressDialog } from \"../components/ProgressDialog\";\nimport nanoid from \"nanoid\";\n\nconst actionQueue: {\n  id: string;\n  params: ActionParams;\n  type:\n    | \"createBlock\"\n    | \"updateBlock\"\n    | \"deleteBlock\"\n    | \"createPage\"\n    | \"updatePage\"\n    | \"deletePage\";\n}[] = [];\n\nconst ROAM_TIMEOUT = 60000;\n\nconst submitActions = (\n  actions: Omit<typeof actionQueue[number], \"id\">[]\n): Promise<void> => {\n  return Promise.all(\n    actions.map(\n      (action) =>\n        new Promise((resolve, reject) => {\n          const { params, type } = action;\n          const id = nanoid();\n          const fire = () =>\n            window.roamAlphaAPI[type](params)\n              .then(resolve)\n              .catch((e) => {\n                if (e.code === \"busy\") {\n                  const detail = {\n                    timeout: ROAM_TIMEOUT + new Date().valueOf(),\n                    id,\n                  };\n                  const element = document.getElementById(ID);\n                  if (element) {\n                    element.dispatchEvent(new CustomEvent(\"log\", { detail }));\n                  } else {\n                    renderProgressDialog(detail);\n                  }\n                  setTimeout(fire, 60000);\n                } else {\n                  reject(e);\n                }\n              });\n          fire();\n        })\n    )\n  ).then(() => Promise.resolve());\n};\n\nexport default submitActions;\n"]}
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const ProgressDialog_1 = require("../components/ProgressDialog");
const nanoid_1 = tslib_1.__importDefault(require("nanoid"));
const actionQueue = [];
const ROAM_TIMEOUT = 60000;
const submitActions = (actions) => {
    return Promise.all(actions.map((action) => new Promise((resolve, reject) => {
        const { params, type } = action;
        const id = (0, nanoid_1.default)();
        const fire = () => window.roamAlphaAPI[type](params)
            .then(resolve)
            .catch((e) => {
            if (e.code === "busy") {
                const detail = {
                    timeout: ROAM_TIMEOUT + new Date().valueOf(),
                    id,
                };
                const element = document.getElementById(ProgressDialog_1.ID);
                if (element) {
                    element.dispatchEvent(new CustomEvent("log", { detail }));
                }
                else {
                    (0, ProgressDialog_1.render)(detail);
                }
                setTimeout(fire, 60000);
            }
            else {
                reject(e);
            }
        });
        fire();
    }))).then(() => Promise.resolve());
};
exports.default = submitActions;
//# sourceMappingURL=submitActions.js.map
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const getPageUidByPageTitle_1 = tslib_1.__importDefault(require("../queries/getPageUidByPageTitle"));
const getRoamUrl_1 = tslib_1.__importDefault(require("./getRoamUrl"));
const createPageTitleObserver = ({ title, callback, log = false, }) => {
    const listener = (url) => {
        const d = document.getElementsByClassName("roam-article")[0];
        if (d) {
            const uid = (0, getPageUidByPageTitle_1.default)(title);
            const attribute = `data-roamjs-${uid}`;
            if ((uid && url === (0, getRoamUrl_1.default)(uid)) || (log && url === (0, getRoamUrl_1.default)())) {
                // React's rerender crushes the old article/heading
                setTimeout(() => {
                    if (!d.hasAttribute(attribute)) {
                        d.setAttribute(attribute, "true");
                        callback(document.getElementsByClassName("roam-article")[0]);
                    }
                }, 1);
            }
            else {
                d.removeAttribute(attribute);
            }
        }
    };
    const wrapped = (e) => listener(e.newURL);
    window.addEventListener("hashchange", wrapped);
    listener(window.location.href);
    return () => window.removeEventListener("hashchange", wrapped);
};
exports.default = createPageTitleObserver;
//# sourceMappingURL=createPageTitleObserver.js.map
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const getBlockUidsByPageTitle_1 = tslib_1.__importDefault(require("../queries/getBlockUidsByPageTitle"));
const createObserver_1 = tslib_1.__importDefault(require("./createObserver"));
const getMutatedNodes_1 = tslib_1.__importDefault(require("./getMutatedNodes"));
const getUids_1 = tslib_1.__importDefault(require("./getUids"));
const createPageObserver = (name, callback) => (0, createObserver_1.default)((ms) => {
    const addedNodes = (0, getMutatedNodes_1.default)({
        ms,
        nodeList: "addedNodes",
        tag: "DIV",
        className: "roam-block",
    }).map((blockNode) => ({
        blockUid: (0, getUids_1.default)(blockNode).blockUid,
        added: true,
    }));
    const removedNodes = (0, getMutatedNodes_1.default)({
        ms,
        nodeList: "removedNodes",
        tag: "DIV",
        className: "roam-block",
    }).map((blockNode) => ({
        blockUid: (0, getUids_1.default)(blockNode).blockUid,
        added: false,
    }));
    if (addedNodes.length || removedNodes.length) {
        const blockUids = new Set((0, getBlockUidsByPageTitle_1.default)(name));
        [...removedNodes, ...addedNodes]
            .filter(({ blockUid }) => blockUids.has(blockUid))
            .forEach(({ blockUid, added }) => callback(blockUid, added));
    }
});
exports.default = createPageObserver;
//# sourceMappingURL=createPageObserver.js.map
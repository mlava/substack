"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const getPageUidByPageTitle_1 = tslib_1.__importDefault(require("../queries/getPageUidByPageTitle"));
const getTextByBlockUid_1 = tslib_1.__importDefault(require("../queries/getTextByBlockUid"));
const constants_1 = require("./constants");
const getRoamUrl_1 = tslib_1.__importDefault(require("./getRoamUrl"));
const aliasTagRegex = new RegExp(`\\[[^\\]]*\\]\\((\\[\\[([^\\]]*)\\]\\])\\)`, "g");
const aliasRefRegex = new RegExp(`\\[[^\\]]*\\]\\((${constants_1.BLOCK_REF_REGEX.source})\\)`, "g");
const resolveRefs = (text) => {
    return text
        .replace(aliasTagRegex, (alias, del, pageName) => {
        const blockUid = (0, getPageUidByPageTitle_1.default)(pageName);
        return alias.replace(del, `${(0, getRoamUrl_1.default)(blockUid)}`);
    })
        .replace(aliasRefRegex, (alias, del, blockUid) => {
        return alias.replace(del, `${(0, getRoamUrl_1.default)(blockUid)}`);
    })
        .replace(new RegExp(constants_1.BLOCK_REF_REGEX, "g"), (_, blockUid) => {
        const reference = (0, getTextByBlockUid_1.default)(blockUid);
        return reference || blockUid;
    });
};
exports.default = resolveRefs;
//# sourceMappingURL=resolveRefs.js.map
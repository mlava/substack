"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const createObserver_1 = tslib_1.__importDefault(require("./createObserver"));
const createOverlayObserver_1 = tslib_1.__importDefault(require("./createOverlayObserver"));
const createHTMLObserver = ({ callback, tag, className, removeCallback, useBody, }) => {
    const getChildren = (d) => Array.from(d.getElementsByClassName(className)).filter((d) => d.nodeName === tag);
    getChildren(document).forEach(callback);
    const isNode = (d) => d.nodeName === tag &&
        Array.from(d.classList).includes(className);
    const getNodes = (nodes) => Array.from(nodes)
        .filter((d) => isNode(d) || d.hasChildNodes())
        .flatMap((d) => (isNode(d) ? [d] : getChildren(d)));
    return (useBody ? createOverlayObserver_1.default : createObserver_1.default)((ms) => {
        const nodes = ms.flatMap((m) => [
            ...getNodes(m.addedNodes).map((node) => ({ node, added: true })),
            ...getNodes(m.removedNodes).map((node) => ({ node, added: false })),
        ]);
        nodes.forEach((b) => b.added
            ? callback(b.node)
            : removeCallback === null || removeCallback === void 0 ? void 0 : removeCallback(b.node));
    });
};
exports.default = createHTMLObserver;
//# sourceMappingURL=createHTMLObserver.js.map
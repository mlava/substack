"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const getPageUidByPageTitle_1 = tslib_1.__importDefault(require("../queries/getPageUidByPageTitle"));
const getPageTitleByHtmlElement_1 = tslib_1.__importDefault(require("./getPageTitleByHtmlElement"));
const getUids_1 = tslib_1.__importDefault(require("./getUids"));
const getDropUidOffset = (d) => {
    var _a, _b, _c;
    const separator = d.parentElement;
    const childrenContainer = separator === null || separator === void 0 ? void 0 : separator.parentElement;
    const children = Array.from((childrenContainer === null || childrenContainer === void 0 ? void 0 : childrenContainer.children) || []);
    const index = children.findIndex((c) => c === separator);
    const offset = children.reduce((prev, cur, ind) => cur.classList.contains("roam-block-container") && ind < index
        ? prev + 1
        : prev, 0);
    const parentBlock = (_b = (_a = childrenContainer === null || childrenContainer === void 0 ? void 0 : childrenContainer.previousElementSibling) === null || _a === void 0 ? void 0 : _a.getElementsByClassName("roam-block")) === null || _b === void 0 ? void 0 : _b[0];
    const parentUid = parentBlock
        ? (0, getUids_1.default)(parentBlock).blockUid
        : childrenContainer
            ? (0, getPageUidByPageTitle_1.default)(((_c = (0, getPageTitleByHtmlElement_1.default)(childrenContainer)) === null || _c === void 0 ? void 0 : _c.textContent) || "")
            : "";
    return {
        parentUid,
        offset,
    };
};
exports.default = getDropUidOffset;
//# sourceMappingURL=getDropUidOffset.js.map
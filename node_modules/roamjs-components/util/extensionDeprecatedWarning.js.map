{"version":3,"file":"extensionDeprecatedWarning.js","sourceRoot":"","sources":["../../src/util/extensionDeprecatedWarning.ts"],"names":[],"mappings":";;;AAAA,oEAAoC;AACpC,2DAAwE;AACxE,2EAA2C;AAC3C,gFAAgD;AAChD,+CAA4D;AAC5D,yGAAyE;AACzE,qGAAqE;AACrE,sEAAsC;AAGtC,MAAM,0BAA0B,GAAG,CAAO,EACxC,WAAW,EACX,MAAM,GAIP,EAAiB,EAAE;IAClB,MAAM,SAAS,GAAG,IAAA,+BAAqB,EAAC,WAAW,CAAC,CAAC;IACrD,MAAM,MAAM,GAAG,IAAA,iCAAuB,EAAC,SAAS,CAAC,CAAC;IAClD,MAAM,iBAAiB,GAAG,IAAA,oBAAU,EAAC;QACnC,IAAI,EAAE,MAAM;QACZ,GAAG,EAAE,mBAAmB;KACzB,CAAC,CAAC,GAAG,CAAC;IACP,IAAI,CAAC,iBAAiB,EAAE;QACtB,MAAM,MAAM,GACV,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAC7B,wIAAwI,WAAW,uCAAuC,CAE7L,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC;QAC9C,IAAA,oBAAiB,EAAC;YAChB,OAAO,EAAE,yDAAyD,IAAA,mBAAS,EACzE,WAAW,CACZ;;EAEL,MAAM;;gEAGA,MAAM,CAAC,MAAM;gBACX,CAAC,CAAC,sCAAsC,IAAA,oBAAU,EAC9C,MAAM,CAAC,CAAC,CAAC,CACV,0BAA0B;gBAC7B,CAAC,CAAC,EACN,oFAAoF;YACpF,SAAS,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,IAAA,qBAAW,EAAC,CAAC,CAAC,CAAC;YAClD,QAAQ,EAAE,GAAG,EAAE,CACb,IAAA,cAAW,EAAC;gBACV,OAAO,EACL,yEAAyE;gBAC3E,EAAE,EAAE,cAAc,WAAW,EAAE;aAChC,CAAC;YACJ,WAAW,EAAE,SAAS;YACtB,aAAa,EAAE,SAAS;SACzB,CAAC,CAAC;KACJ;AACH,CAAC,CAAA,CAAC;AAEF,kBAAe,0BAA0B,CAAC","sourcesContent":["import idToTitle from \"./idToTitle\";\nimport { render as renderSimpleAlert } from \"../components/SimpleAlert\";\nimport getRoamUrl from \"../dom/getRoamUrl\";\nimport deleteBlock from \"../writes/deleteBlock\";\nimport { render as renderToast } from \"../components/Toast\";\nimport getBasicTreeByParentUid from \"../queries/getBasicTreeByParentUid\";\nimport getPageUidByPageTitle from \"../queries/getPageUidByPageTitle\";\nimport getSubTree from \"./getSubTree\";\nimport { PullBlock } from \"../types\";\n\nconst extensionDeprecatedWarning = async ({\n  extensionId,\n  reason,\n}: {\n  extensionId: string;\n  reason: string;\n}): Promise<void> => {\n  const configUid = getPageUidByPageTitle(extensionId);\n  const config = getBasicTreeByParentUid(configUid);\n  const donotShowAgainUid = getSubTree({\n    tree: config,\n    key: \"Do not show again\",\n  }).uid;\n  if (!donotShowAgainUid) {\n    const blocks = (\n      window.roamAlphaAPI.data.fast.q(\n        `[:find (pull ?roamjs [:block/uid]) :where [?block :block/string ?contents] [(clojure.string/includes? ?contents  \"https://roamjs.com/${extensionId}\")] [?roamjs :block/children ?block]]`\n      ) as [PullBlock][]\n    ).map(([block]) => block[\":block/uid\"] || \"\");\n    renderSimpleAlert({\n      content: `RoamJS will soon be deprecating and then removing the ${idToTitle(\n        extensionId\n      )} extension.\n\n${reason}\n\nIf you no longer use this extension, feel free to uninstall it${\n        blocks.length\n          ? ` by removing the block from [here](${getRoamUrl(\n              blocks[0]\n            )}) or by clicking confirm`\n          : \"\"\n      }. If this will be an issue for any reason, please reach out to support@roamjs.com.`,\n      onConfirm: () => blocks.map((b) => deleteBlock(b)),\n      onCancel: () =>\n        renderToast({\n          content:\n            \"Reach out to supprt@roamjs.com if you would like to keep the extension.\",\n          id: `deprecated-${extensionId}`,\n        }),\n      confirmText: \"Confirm\",\n      dontShowAgain: configUid,\n    });\n  }\n};\n\nexport default extensionDeprecatedWarning;\n"]}
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const getBasicTreeByParentUid_1 = tslib_1.__importDefault(require("../queries/getBasicTreeByParentUid"));
const createBlock_1 = tslib_1.__importDefault(require("../writes/createBlock"));
const updateBlock_1 = tslib_1.__importDefault(require("../writes/updateBlock"));
const toFlexRegex_1 = tslib_1.__importDefault(require("./toFlexRegex"));
const setInputSetting = ({ blockUid, value, key, index = 0, }) => {
    const tree = (0, getBasicTreeByParentUid_1.default)(blockUid);
    const keyNode = tree.find((t) => (0, toFlexRegex_1.default)(key).test(t.text));
    if (keyNode && keyNode.children.length) {
        return (0, updateBlock_1.default)({
            uid: keyNode.children[0].uid,
            text: value,
        });
    }
    else if (!keyNode) {
        const uid = window.roamAlphaAPI.util.generateUID();
        return (0, createBlock_1.default)({
            parentUid: blockUid,
            order: index,
            node: { text: key, uid },
        }).then(() => (0, createBlock_1.default)({
            parentUid: uid,
            order: 0,
            node: { text: value },
        }));
    }
    else {
        return (0, createBlock_1.default)({
            parentUid: keyNode.uid,
            order: 0,
            node: { text: value },
        });
    }
};
exports.default = setInputSetting;
//# sourceMappingURL=setInputSetting.js.map
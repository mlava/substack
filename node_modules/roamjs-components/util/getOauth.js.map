{"version":3,"file":"getOauth.js","sourceRoot":"","sources":["../../src/util/getOauth.ts"],"names":[],"mappings":"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","sourcesContent":["import getEditTimeByBlockUid from \"../queries/getEditTimeByBlockUid\";\nimport getPageUidByPageTitle from \"../queries/getPageUidByPageTitle\";\nimport getShallowTreeByParentUid from \"../queries/getShallowTreeByParentUid\";\nimport localStorageGet from \"./localStorageGet\";\nimport toConfigPageName from \"./toConfigPageName\";\nimport toFlexRegex from \"./toFlexRegex\";\n\nconst getOauth = (service: string, label?: string): string => {\n  const fromStorage = localStorageGet(`oauth-${service}`);\n  if (fromStorage) {\n    const accounts = JSON.parse(fromStorage) as {\n      text: string;\n      data: string;\n    }[];\n    const accountNode =\n      (label ? accounts.find(({ text }) => text === label) : accounts[0]) ||\n      ({} as { data?: string });\n    const { data, ...node } = accountNode;\n    return data ? JSON.stringify({ ...JSON.parse(data), node }) : \"{}\";\n  }\n  const tree = getShallowTreeByParentUid(\n    getPageUidByPageTitle(toConfigPageName(service))\n  );\n  const node = tree.find((s) => toFlexRegex(\"oauth\").test(s.text.trim()));\n  if (!node) {\n    return \"{}\";\n  }\n  const nodeChildren = getShallowTreeByParentUid(node.uid);\n  const index = label\n    ? nodeChildren.findIndex((t) => toFlexRegex(label).test(t.text))\n    : 0;\n  const labelNode = nodeChildren[index];\n  if (!labelNode) {\n    return \"{}\";\n  }\n  if (labelNode.text.startsWith(\"{\") && labelNode.text.endsWith(\"}\")) {\n    const obj = JSON.parse(labelNode.text);\n    obj.node = {\n      uid: labelNode.uid,\n      time: getEditTimeByBlockUid(labelNode.uid),\n    };\n    return JSON.stringify(obj);\n  }\n  const dataNode = getShallowTreeByParentUid(labelNode.uid)[0];\n  const uid = dataNode?.uid || \"\";\n  if (!dataNode?.text) {\n    return \"{}\";\n  }\n  const obj = JSON.parse(dataNode.text);\n  obj.node = {\n    uid,\n    time: uid ? getEditTimeByBlockUid(uid) : 0,\n  };\n  return JSON.stringify(obj);\n};\n\nexport default getOauth;\n"]}
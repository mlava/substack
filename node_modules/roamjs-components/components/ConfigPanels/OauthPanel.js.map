{"version":3,"file":"OauthPanel.js","sourceRoot":"","sources":["../../../src/components/ConfigPanels/OauthPanel.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Button, Checkbox } from \"@blueprintjs/core\";\nimport React, { useCallback, useState } from \"react\";\nimport getBasicTreeByParentUid from \"../../queries/getBasicTreeByParentUid\";\nimport getShallowTreeByParentUid from \"../../queries/getShallowTreeByParentUid\";\nimport localStorageGet from \"../../util/localStorageGet\";\nimport localStorageRemove from \"../../util/localStorageRemove\";\nimport { localStorageSet } from \"../../util/localStorageSet\";\nimport deleteBlock from \"../../writes/deleteBlock\";\nimport Description from \"../Description\";\nimport ExternalLogin from \"../ExternalLogin\";\nimport type { OauthField, FieldPanel } from \"./types\";\n\nconst OauthPanel: FieldPanel<OauthField> = ({ uid, parentUid, options }) => {\n  const key = `oauth-${options.service}`;\n  const [useLocal, setUseLocal] = useState(!!localStorageGet(key));\n  const [accounts, setAccounts] = useState<\n    { text: string; uid: string; data: string }[]\n  >(() =>\n    useLocal\n      ? JSON.parse(localStorageGet(key) as string)\n      : uid\n      ? getBasicTreeByParentUid(uid).map((v) => ({\n          text: v.children[0]?.text ? v.text : \"Default Account\",\n          uid: v.uid,\n          data: v.children[0]?.text || v.text,\n        }))\n      : []\n  );\n  const onCheck = useCallback(\n    (e) => {\n      const checked = (e.target as HTMLInputElement).checked;\n      setUseLocal(checked);\n      if (checked) {\n        if (uid) {\n          getShallowTreeByParentUid(uid).forEach(({ uid: u }) =>\n            deleteBlock(u)\n          );\n        }\n        localStorageSet(key, JSON.stringify(accounts));\n      } else {\n        localStorageRemove(key);\n        if (uid) {\n          accounts.forEach(({ text, uid: u, data }, order) => {\n            window.roamAlphaAPI.createBlock({\n              location: { \"parent-uid\": uid, order },\n              block: { string: text, uid: u },\n            });\n            window.roamAlphaAPI.createBlock({\n              location: { \"parent-uid\": u, order: 0 },\n              block: { string: data },\n            });\n          });\n        }\n      }\n    },\n    [setUseLocal, accounts, uid, key]\n  );\n  return (\n    <>\n      <Checkbox\n        labelElement={\n          <>\n            Store Locally\n            <Description\n              description={\n                \"If checked, sensitive authentication data will be stored locally on your machine and will require re-logging in per device. If unchecked, sensitive authentication data will be stored in your Roam Graph.\"\n              }\n            />\n          </>\n        }\n        checked={useLocal}\n        onChange={onCheck}\n      />\n      <ExternalLogin\n        useLocal={useLocal}\n        onSuccess={(acc) => setAccounts([...accounts, acc])}\n        parentUid={parentUid}\n        loggedIn={!!accounts.length}\n        {...options}\n      />\n      {!!accounts.length && (\n        <>\n          <h5 style={{ marginTop: 8 }}>Accounts</h5>\n          <hr />\n          <ul style={{ marginTop: 8, padding: 0 }}>\n            {accounts.map((act) => (\n              <li\n                key={act.uid}\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"space-between\",\n                  alignItems: \"center\",\n                  marginTop: 8,\n                }}\n              >\n                <span style={{ minWidth: 192 }}>{act.text}</span>\n                <Button\n                  text={\"Log Out\"}\n                  onClick={() => {\n                    if (useLocal) {\n                      const accts = JSON.parse(\n                        localStorageGet(key) as string\n                      ) as {\n                        uid: string;\n                      }[];\n                      localStorageSet(\n                        key,\n                        JSON.stringify(accts.filter((a) => act.uid !== a.uid))\n                      );\n                    } else {\n                      deleteBlock(act.uid);\n                    }\n                    setAccounts(accounts.filter((a) => act.uid !== a.uid));\n                  }}\n                />\n              </li>\n            ))}\n          </ul>\n        </>\n      )}\n    </>\n  );\n};\n\nOauthPanel.type = \"oauth\";\n\nexport default OauthPanel;\n"]}
{"version":3,"file":"BlocksPanel.js","sourceRoot":"","sources":["../../../src/components/ConfigPanels/BlocksPanel.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Button, Label, Tooltip } from \"@blueprintjs/core\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport getFirstChildUidByBlockUid from \"../../queries/getFirstChildUidByBlockUid\";\nimport idToTitle from \"../../util/idToTitle\";\nimport createBlock from \"../../writes/createBlock\";\nimport Description from \"../Description\";\nimport type { FieldPanel, BlocksField } from \"./types\";\n\nconst BlocksPanel: FieldPanel<BlocksField> = ({\n  uid: initialUid,\n  parentUid,\n  title,\n  defaultValue,\n  description,\n}) => {\n  const containerRef = useRef(null);\n  const [navUid, setNavUid] = useState(initialUid || parentUid);\n  useEffect(() => {\n    if (containerRef.current) {\n      const el = containerRef.current;\n      (initialUid\n        ? Promise.resolve(initialUid)\n        : createBlock({ node: { text: title, children: [] }, parentUid }).then(\n            (uid) => {\n              setNavUid(uid);\n              return uid;\n            }\n          )\n      )\n        .then((formatUid) =>\n          getFirstChildUidByBlockUid(formatUid)\n            ? formatUid\n            : (defaultValue?.length\n                ? Promise.all(\n                    defaultValue.map((node, order) =>\n                      createBlock({\n                        node,\n                        parentUid: formatUid,\n                        order,\n                      })\n                    )\n                  )\n                : createBlock({\n                    node: { text: \" \" },\n                    parentUid: formatUid,\n                  })\n              ).then(() => formatUid)\n        )\n        .then((uid) => {\n          window.roamAlphaAPI.ui.components.renderBlock({\n            uid,\n            el,\n          });\n        });\n    }\n  }, [containerRef, defaultValue, setNavUid]);\n  return (\n    <>\n      <Label>\n        {idToTitle(title)}\n        <Description description={description} />\n        <Tooltip content={\"Click here to edit these blocks directly\"}>\n          <Button\n            icon={\"link\"}\n            minimal\n            onClick={() =>\n              window.roamAlphaAPI.ui.mainWindow.openBlock({\n                block: { uid: navUid },\n              })\n            }\n          />\n        </Tooltip>\n      </Label>\n      <style>{`.roamjs-config-blocks > div > .rm-block-main {\n    display: none;\n  }\n  \n  .roamjs-config-blocks > div > .rm-block-children > .rm-multibar {\n    display: none;\n  }\n  \n  .roamjs-config-blocks > div > .rm-block-children {\n    margin-left: -4px;\n  }`}</style>\n      <div\n        ref={containerRef}\n        style={{\n          border: \"1px solid #33333333\",\n          padding: \"8px 0\",\n          borderRadius: 4,\n        }}\n        className={\"roamjs-config-blocks\"}\n      ></div>\n    </>\n  );\n};\n\nBlocksPanel.type = \"blocks\";\n\nexport default BlocksPanel;\n"]}
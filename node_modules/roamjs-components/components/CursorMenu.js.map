{"version":3,"file":"CursorMenu.js","sourceRoot":"","sources":["../../src/components/CursorMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Menu, MenuItem, Popover, Position } from \"@blueprintjs/core\";\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport fuzzy from \"fuzzy\";\nimport getUids from \"../dom/getUids\";\nimport updateBlock from \"../writes/updateBlock\";\n\n// inspired by https://github.com/zurb/tribute/blob/master/src/TributeRange.js#L446-L556\nexport const getCoordsFromTextarea = (\n  t: HTMLTextAreaElement\n): { top: number; left: number } => {\n  const properties = [\n    \"direction\",\n    \"boxSizing\",\n    \"width\",\n    \"height\",\n    \"overflowX\",\n    \"overflowY\",\n    \"borderTopWidth\",\n    \"borderRightWidth\",\n    \"borderBottomWidth\",\n    \"borderLeftWidth\",\n    \"paddingTop\",\n    \"paddingRight\",\n    \"paddingBottom\",\n    \"paddingLeft\",\n    \"fontStyle\",\n    \"fontVariant\",\n    \"fontWeight\",\n    \"fontStretch\",\n    \"fontSize\",\n    \"fontSizeAdjust\",\n    \"lineHeight\",\n    \"fontFamily\",\n    \"textAlign\",\n    \"textTransform\",\n    \"textIndent\",\n    \"textDecoration\",\n    \"letterSpacing\",\n    \"wordSpacing\",\n  ] as const;\n\n  const div = document.createElement(\"div\");\n  div.id = \"input-textarea-caret-position-mirror-div\";\n  document.body.appendChild(div);\n\n  const style = div.style;\n  const computed = getComputedStyle(t);\n\n  style.whiteSpace = \"pre-wrap\";\n  style.wordWrap = \"break-word\";\n\n  // position off-screen\n  style.position = \"absolute\";\n  style.visibility = \"hidden\";\n  style.overflow = \"hidden\";\n\n  // transfer the element's properties to the div\n  properties.forEach((prop) => {\n    style[prop] = computed[prop];\n  });\n\n  div.textContent = t.value.substring(0, t.selectionStart);\n\n  const span = document.createElement(\"span\");\n  span.textContent = t.value.substring(t.selectionStart) || \".\";\n  div.appendChild(span);\n\n  const doc = document.documentElement;\n  const windowLeft =\n    (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);\n  const windowTop =\n    (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);\n\n  const coordinates = {\n    top:\n      windowTop +\n      span.offsetTop +\n      parseInt(computed.borderTopWidth) +\n      parseInt(computed.fontSize) -\n      t.scrollTop -\n      9,\n    left: windowLeft + span.offsetLeft + parseInt(computed.borderLeftWidth) - 1,\n  };\n  document.body.removeChild(div);\n  return coordinates;\n};\n\ntype Props<T> = {\n  textarea: HTMLTextAreaElement;\n  onItemSelect: (item: { text: string; id: string } & T) => void;\n  initialItems: ({ text: string; id: string } & T)[];\n};\n\nconst VALID_FILTER = /^[\\w\\d\\s_-]$/;\n\nconst CursorMenu = <T extends Record<string, string>>({\n  textarea,\n  onClose,\n  onItemSelect,\n  initialItems,\n}: {\n  onClose: () => void;\n} & Props<T>): React.ReactElement => {\n  const itemsById = useMemo(\n    () => Object.fromEntries(initialItems.map((item) => [item.id, item])),\n    [initialItems]\n  );\n  const menuRef = useRef<HTMLUListElement>(null);\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [filter, setFilter] = useState(\"\");\n  const onPopoverClose = useCallback(() => {\n    if (menuRef.current) {\n      const value = menuRef.current.getAttribute(\"data-filter\");\n      const text = `${textarea.value.substring(\n        0,\n        textarea.selectionStart\n      )}${value}${textarea.value.substring(textarea.selectionStart)}`;\n      updateBlock({ uid: getUids(textarea).blockUid, text });\n      setTimeout(() => {\n        textarea.setSelectionRange(\n          textarea.selectionStart + text.length,\n          textarea.selectionEnd + text.length\n        );\n        onClose();\n      }, 1);\n    }\n  }, [onClose, textarea, menuRef]);\n  const items = useMemo(\n    () =>\n      (filter\n        ? fuzzy\n            .filter(filter, initialItems, {\n              extract: (s) => s.text,\n              pre: \"<b>\",\n              post: \"</b>\",\n            })\n            .map((r) => ({ ...r.original, displayName: r.string }))\n        : initialItems.map((r) => ({ ...r, displayName: r.text }))\n      ).slice(0, 10),\n    [filter, initialItems]\n  );\n  const onSelect = useCallback(\n    (item) => {\n      if (menuRef.current) {\n        onItemSelect(item);\n        onClose();\n      }\n    },\n    [menuRef, onClose, textarea, onItemSelect]\n  );\n  const keydownListener = useCallback(\n    (e: KeyboardEvent) => {\n      if (\n        menuRef.current &&\n        (e.key === \"ArrowRight\" || e.key === \"ArrowDown\")\n      ) {\n        const index = Number(menuRef.current.getAttribute(\"data-active-index\"));\n        const count = menuRef.current.childElementCount;\n        setActiveIndex((index + 1) % count);\n      } else if (\n        menuRef.current &&\n        (e.key === \"ArrowLeft\" || e.key === \"ArrowUp\")\n      ) {\n        const index = Number(menuRef.current.getAttribute(\"data-active-index\"));\n        const count = menuRef.current.childElementCount;\n        setActiveIndex((index - 1 + count) % count);\n      } else if (menuRef.current && e.key === \"Enter\") {\n        const index = Number(menuRef.current.getAttribute(\"data-active-index\"));\n        const id =\n          menuRef.current.children[index]\n            .querySelector(\".bp3-menu-item\")\n            ?.getAttribute(\"data-id\") || \"\";\n        onSelect(itemsById[id]);\n      } else if (menuRef.current && VALID_FILTER.test(e.key)) {\n        const value = menuRef.current.getAttribute(\"data-filter\");\n        setFilter(`${value}${e.key}`);\n      } else if (menuRef.current && e.key === \"Backspace\") {\n        const value = menuRef.current.getAttribute(\"data-filter\");\n        if (value) {\n          setFilter(value.slice(0, -1));\n        } else {\n          onClose();\n          return;\n        }\n      } else if (e.key !== \"Shift\") {\n        onPopoverClose();\n        return;\n      }\n      e.stopPropagation();\n      e.preventDefault();\n    },\n    [menuRef, setActiveIndex, onClose, onPopoverClose]\n  );\n  useEffect(() => {\n    textarea.addEventListener(\"keydown\", keydownListener);\n    return () => {\n      textarea.removeEventListener(\"keydown\", keydownListener);\n    };\n  }, [keydownListener]);\n  return (\n    <Popover\n      onClose={onPopoverClose}\n      isOpen={true}\n      canEscapeKeyClose\n      minimal\n      target={<span />}\n      position={Position.BOTTOM_LEFT}\n      modifiers={{\n        flip: { enabled: false },\n        preventOverflow: { enabled: false },\n      }}\n      autoFocus={false}\n      content={\n        <Menu\n          ulRef={menuRef}\n          data-active-index={activeIndex}\n          data-filter={filter}\n          style={{ width: 300 }}\n        >\n          {items.length ? (\n            items.map(({ id, displayName }, i) => {\n              return (\n                <MenuItem\n                  key={id}\n                  data-id={id}\n                  text={displayName\n                    .split(/<b>(.*?)<\\/b>/)\n                    .map((part, i) =>\n                      i % 2 === 1 ? (\n                        <b key={i}>{part}</b>\n                      ) : (\n                        <span key={i}>{part}</span>\n                      )\n                    )}\n                  active={i === activeIndex}\n                  onMouseEnter={() => setActiveIndex(i)}\n                  onClick={() => setTimeout(() => onSelect(itemsById[id]), 1)}\n                />\n              );\n            })\n          ) : (\n            <MenuItem\n              text={\n                <span style={{ opacity: 0.75 }}>\n                  <i>None</i>\n                </span>\n              }\n              active={false}\n              disabled={true}\n            />\n          )}\n        </Menu>\n      }\n    />\n  );\n};\n\nexport const render = <T extends Record<string, string>>(\n  props: Props<T>\n): void => {\n  const parent = document.createElement(\"span\");\n  const coords = getCoordsFromTextarea(props.textarea);\n  parent.style.position = \"absolute\";\n  parent.style.left = `${coords.left}px`;\n  parent.style.top = `${coords.top}px`;\n  props.textarea.parentElement?.insertBefore(parent, props.textarea);\n  ReactDOM.render(\n    <CursorMenu\n      {...props}\n      onClose={() => {\n        ReactDOM.unmountComponentAtNode(parent);\n        parent.remove();\n      }}\n    />,\n    parent\n  );\n};\n\nexport default CursorMenu;\n"]}